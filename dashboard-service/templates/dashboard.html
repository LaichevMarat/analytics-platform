<!DOCTYPE html>
<html>
<head>
    <title>Analytics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .metrics { display: flex; gap: 20px; margin-bottom: 30px; }
        .metric-card { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px; 
            border-radius: 8px;
            flex: 1;
            text-align: center;
        }
        .metric-card h3 { margin: 0 0 10px 0; font-size: 14px; opacity: 0.9; }
        .metric-card p { margin: 0; font-size: 24px; font-weight: bold; }
        .chart-container { margin: 30px 0; background: white; padding: 20px; border-radius: 8px; border: 1px solid #ddd; }
        .refresh-btn { 
            background: #4CAF50; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer;
            font-size: 16px;
        }
        .refresh-btn:hover { background: #45a049; }
        .error { color: red; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Analytics Dashboard</h1>
        <p>Real-time user analytics from your application</p>
        
        <div class="metrics">
            <div class="metric-card">
                <h3>Total Events</h3>
                <p id="totalEvents">0</p>
            </div>
            <div class="metric-card">
                <h3>Unique Users</h3>
                <p id="uniqueUsers">0</p>
            </div>
            <div class="metric-card">
                <h3>Popular Page</h3>
                <p id="popularPage">-</p>
            </div>
        </div>

        <div class="chart-container">
            <h3>Events by Type</h3>
            <canvas id="eventsChart" width="400" height="200"></canvas>
        </div>

        <button class="refresh-btn" onclick="loadData()">üîÑ Refresh Data</button>
        <div id="errorMessage" class="error"></div>

        <div style="margin-top: 30px; font-size: 12px; color: #666;">
            <p>Last updated: <span id="lastUpdated">-</span></p>
        </div>
    </div>

    <script>
        let eventsChart = null;

        async function loadData() {
            try {
                document.getElementById('errorMessage').textContent = '';
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º summary –¥–∞–Ω–Ω—ã–µ
                const summaryResponse = await fetch('/api/data/summary');
                const summaryData = await summaryResponse.json();
                
                if (summaryData.error) {
                    throw new Error(summaryData.error);
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏
                document.getElementById('totalEvents').textContent = summaryData.total_events;
                document.getElementById('uniqueUsers').textContent = summaryData.unique_users;
                document.getElementById('popularPage').textContent = summaryData.popular_page;
                document.getElementById('lastUpdated').textContent = new Date().toLocaleString();

                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
                const eventsResponse = await fetch('/api/data/events-by-type');
                const eventsData = await eventsResponse.json();
                
                if (eventsData.error) {
                    throw new Error(eventsData.error);
                }

                updateChart(eventsData.events_by_type);

            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('errorMessage').textContent = 'Error loading data: ' + error.message;
            }
        }

        function updateChart(eventsData) {
            const ctx = document.getElementById('eventsChart').getContext('2d');
            
            // –ï—Å–ª–∏ –≥—Ä–∞—Ñ–∏–∫ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —É–Ω–∏—á—Ç–æ–∂–∞–µ–º –µ–≥–æ
            if (eventsChart) {
                eventsChart.destroy();
            }

            const labels = eventsData.map(item => item.event_type);
            const data = eventsData.map(item => item.count);

            // –¶–≤–µ—Ç–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π
            const backgroundColors = [
                '#FF6384', // red
                '#36A2EB', // blue
                '#FFCE56', // yellow
                '#4BC0C0', // teal
                '#9966FF', // purple
            ];

            eventsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Number of Events',
                        data: data,
                        backgroundColor: backgroundColors,
                        borderColor: backgroundColors.map(color => color.replace('0.2', '1')),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        loadData();
        setInterval(loadData, 30000);
    </script>
</body>
</html>